// Generated by CoffeeScript 2.7.0
// static/coffee/payment.coffee

// Global variables
var bankAccountElement, checkPaymentStatus, clearMessage, confirmPayment, currentAmount, currentMonth, currentYear, elements, getPaymentPeriod, initializeStripe, loadRentPeriod, paymentIntent, processPayment, showMessage, stripe;

stripe = null;

elements = null;

bankAccountElement = null;

paymentIntent = null;

currentYear = null;

currentMonth = null;

currentAmount = null;

// Get payment period from URL query string
getPaymentPeriod = function() {
  var month, params, year;
  params = new URLSearchParams(window.location.search);
  year = parseInt(params.get('year'));
  month = parseInt(params.get('month'));
  return {year, month};
};

// Initialize on page load
document.addEventListener('DOMContentLoaded', async function() {
  var month, year;
  // Require authentication
  await requireAuth();
  // Get payment period
  ({year, month} = getPaymentPeriod());
  if (!(year && month)) {
    showMessage('Invalid payment period', 'error');
    return;
  }
  currentYear = year;
  currentMonth = month;
  // Load rent period info
  await loadRentPeriod(year, month);
  // Initialize Stripe
  return (await initializeStripe());
});

// Load rent period details
loadRentPeriod = async function(year, month) {
  var amountDue, data, err, monthName, response;
  try {
    response = (await fetch(`/rent/period/${year}/${month}`));
    data = (await response.json());
    if (!response.ok) {
      throw new Error(data.error || 'Failed to load rent period');
    }
    // Display payment info
    monthName = new Date(year, month - 1).toLocaleString('default', {
      month: 'long'
    });
    document.getElementById('payment-period').textContent = `${monthName} ${year}`;
    amountDue = data.amount_due - (data.amount_paid || 0);
    currentAmount = amountDue;
    document.getElementById('payment-amount').textContent = `$${amountDue.toFixed(2)}`;
    if (amountDue <= 0) {
      showMessage('This period is already paid in full', 'success');
      return document.getElementById('pay-button').disabled = true;
    }
  } catch (error) {
    err = error;
    console.error('Load rent period error:', err);
    return showMessage(err.message, 'error');
  }
};

// Initialize Stripe
initializeStripe = async function() {
  var config, err, response;
  try {
    console.log('Step 1: Fetching Stripe config...');
    // Get publishable key from backend
    response = (await fetch('/payment/config'));
    config = (await response.json());
    console.log('Step 2: Got config:', config);
    if (!config.publishableKey) {
      throw new Error('Stripe not configured');
    }
    console.log('Step 3: Checking Stripe.js loaded...');
    if (!window.Stripe) {
      throw new Error('Stripe.js not loaded - check script tag');
    }
    console.log('Step 4: Initializing Stripe...');
    // Initialize Stripe
    stripe = Stripe(config.publishableKey);
    // Create elements with payment intent client secret options
    // For now, create without client secret - will be created on submit
    elements = stripe.elements({
      mode: 'payment',
      amount: currentAmount * 100, // Stripe uses cents
      currency: 'usd',
      payment_method_types: ['us_bank_account']
    });
    console.log('Step 5: Creating payment element...');
    // Create unified payment element (supports multiple payment methods)
    bankAccountElement = elements.create('payment', {
      layout: 'tabs',
      paymentMethodOrder: ['us_bank_account']
    });
    console.log('Step 6: Mounting element...');
    bankAccountElement.mount('#bank-account-element');
    console.log('Step 7: Stripe initialized successfully');
    // Enable pay button when element is ready
    bankAccountElement.on('ready', function() {
      console.log('Stripe element ready');
      return document.getElementById('pay-button').disabled = false;
    });
    return bankAccountElement.on('change', function(event) {
      if (event.error) {
        return showMessage(event.error.message, 'error');
      } else {
        return clearMessage();
      }
    });
  } catch (error) {
    err = error;
    console.error('Initialize Stripe error:', err);
    console.error('Error stack:', err.stack);
    return showMessage(`Failed to initialize payment system: ${err.message}`, 'error');
  }
};

// Handle payment submission
document.addEventListener('click', async function(e) {
  if (e.target.id === 'pay-button') {
    e.preventDefault();
    return (await processPayment());
  }
});

processPayment = async function() {
  var clientSecret, data, err, payButton, ref, ref1, response, result, submitResult, user;
  payButton = document.getElementById('pay-button');
  payButton.disabled = true;
  payButton.textContent = 'Processing...';
  try {
    // Step 1: Submit the payment element to validate and collect data
    console.log('Step 1: Submitting payment element...');
    submitResult = (await elements.submit());
    if (submitResult.error) {
      throw new Error(submitResult.error.message);
    }
    console.log('Step 2: Creating payment intent...');
    // Step 2: Create payment intent on server
    response = (await fetch('/payment/create-intent', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        year: currentYear,
        month: currentMonth,
        amount: currentAmount
      })
    }));
    data = (await response.json());
    if (!response.ok) {
      throw new Error(data.error || 'Failed to create payment intent');
    }
    clientSecret = data.clientSecret;
    console.log('Step 3: Confirming payment...');
    // Step 3: Confirm payment using the unified Payment Element
    user = (await getCurrentUser());
    result = (await stripe.confirmPayment({
      elements: elements,
      clientSecret: clientSecret,
      confirmParams: {
        return_url: `${window.location.origin}/payment/confirm?year=${currentYear}&month=${currentMonth}`,
        payment_method_data: {
          billing_details: {
            name: user.email,
            email: user.email
          }
        }
      },
      redirect: 'if_required'
    }));
    if (result.error) {
      throw new Error(result.error.message);
    }
    console.log('Step 4: Payment result:', (ref = result.paymentIntent) != null ? ref.status : void 0);
    // Payment initiated successfully
    if (((ref1 = result.paymentIntent) != null ? ref1.status : void 0) === 'succeeded') {
      // Payment completed immediately
      return (await confirmPayment(result.paymentIntent.id));
    } else {
      // Payment requires additional action
      showMessage('Payment initiated! You may need to verify with your bank.', 'success');
      return (await checkPaymentStatus(result.paymentIntent.id));
    }
  } catch (error) {
    err = error;
    console.error('Process payment error:', err);
    showMessage(err.message, 'error');
    payButton.disabled = false;
    return payButton.textContent = 'Process Payment';
  }
};

// Check payment status and confirm
checkPaymentStatus = async function(paymentIntentId) {
  var attempt, checkStatus, err, maxAttempts;
  try {
    // Poll for payment status
    maxAttempts = 30;
    attempt = 0;
    checkStatus = async function() {
      var response, status;
      attempt++;
      response = (await fetch(`/payment/status/${paymentIntentId}`));
      status = (await response.json());
      if (status.status === 'succeeded') {
        // Confirm payment in backend
        await confirmPayment(paymentIntentId);
        return true;
      } else if (status.status === 'requires_action' || status.status === 'processing') {
        if (attempt < maxAttempts) {
          return setTimeout(checkStatus, 2000); // Check again in 2 seconds
        } else {
          showMessage('Payment is processing. Check back later.', 'success');
          return setTimeout((function() {
            return window.location.href = '/rent';
          }), 3000);
        }
      } else if (status.status === 'requires_payment_method') {
        throw new Error('Payment method verification required');
      } else {
        throw new Error(`Payment failed: ${status.status}`);
      }
    };
    return (await checkStatus());
  } catch (error) {
    err = error;
    console.error('Check payment status error:', err);
    return showMessage(err.message, 'error');
  }
};

// Confirm payment in backend
confirmPayment = async function(paymentIntentId) {
  var data, err, response;
  try {
    response = (await fetch('/payment/confirm', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        paymentIntentId: paymentIntentId,
        year: currentYear,
        month: currentMonth
      })
    }));
    data = (await response.json());
    if (!response.ok) {
      throw new Error(data.error || 'Failed to confirm payment');
    }
    showMessage('Payment successful! Redirecting...', 'success');
    return setTimeout((function() {
      return window.location.href = '/rent';
    }), 2000);
  } catch (error) {
    err = error;
    console.error('Confirm payment error:', err);
    return showMessage(err.message, 'error');
  }
};

// Show message to user
showMessage = function(text, type) {
  var container;
  container = document.getElementById('message-container');
  return container.innerHTML = `<div class="message ${type}">${text}</div>`;
};

clearMessage = function() {
  var container;
  container = document.getElementById('message-container');
  return container.innerHTML = '';
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGF5bWVudC5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8iLCJzb3VyY2VzIjpbInN0YXRpYy9jb2ZmZWUvcGF5bWVudC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUVrQjs7O0FBQUEsSUFBQSxrQkFBQSxFQUFBLGtCQUFBLEVBQUEsWUFBQSxFQUFBLGNBQUEsRUFBQSxhQUFBLEVBQUEsWUFBQSxFQUFBLFdBQUEsRUFBQSxRQUFBLEVBQUEsZ0JBQUEsRUFBQSxnQkFBQSxFQUFBLGNBQUEsRUFBQSxhQUFBLEVBQUEsY0FBQSxFQUFBLFdBQUEsRUFBQTs7QUFDbEIsTUFBQSxHQUFtQjs7QUFDbkIsUUFBQSxHQUFtQjs7QUFDbkIsa0JBQUEsR0FBcUI7O0FBQ3JCLGFBQUEsR0FBbUI7O0FBQ25CLFdBQUEsR0FBbUI7O0FBQ25CLFlBQUEsR0FBbUI7O0FBQ25CLGFBQUEsR0FBbUIsS0FQRDs7O0FBVWxCLGdCQUFBLEdBQW1CLFFBQUEsQ0FBQSxDQUFBO0FBQ25CLE1BQUEsS0FBQSxFQUFBLE1BQUEsRUFBQTtFQUFFLE1BQUEsR0FBUyxJQUFJLGVBQUosQ0FBb0IsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFwQztFQUNULElBQUEsR0FBTyxRQUFBLENBQVMsTUFBTSxDQUFDLEdBQVAsQ0FBVyxNQUFYLENBQVQ7RUFDUCxLQUFBLEdBQVEsUUFBQSxDQUFTLE1BQU0sQ0FBQyxHQUFQLENBQVcsT0FBWCxDQUFUO1NBQ1IsQ0FBRSxJQUFGLEVBQVEsS0FBUjtBQUppQixFQVZEOzs7QUFpQmxCLFFBQVEsQ0FBQyxnQkFBVCxDQUEwQixrQkFBMUIsRUFBOEMsTUFBQSxRQUFBLENBQUEsQ0FBQTtBQUM5QyxNQUFBLEtBQUEsRUFBQSxJQUFBOztFQUNFLE1BQU0sV0FBQSxDQUFBLEVBRFI7O0VBSUUsQ0FBQSxDQUFFLElBQUYsRUFBUSxLQUFSLENBQUEsR0FBa0IsZ0JBQUEsQ0FBQSxDQUFsQjtFQUVBLE1BQU8sSUFBQSxJQUFTLE1BQWhCO0lBQ0UsV0FBQSxDQUFZ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QUF6QixFQUZGOztBQWxCZSxFQTlOQzs7O0FBcVBsQixXQUFBLEdBQWMsUUFBQSxDQUFDLElBQUQsRUFBTyxJQUFQLENBQUE7QUFDZCxNQUFBO0VBQUUsU0FBQSxHQUFZLFFBQVEsQ0FBQyxjQUFULENBQXdCLG1CQUF4QjtTQUNaLFNBQVMsQ0FBQyxTQUFWLEdBQXNCLENBQUEsb0JBQUEsQ0FBQSxDQUNFLElBREYsQ0FBQSxFQUFBLENBQUEsQ0FDVyxJQURYLENBQUEsTUFBQTtBQUZWOztBQU1kLFlBQUEsR0FBZSxRQUFBLENBQUEsQ0FBQTtBQUNmLE1BQUE7RUFBRSxTQUFBLEdBQVksUUFBUSxDQUFDLGNBQVQsQ0FBd0IsbUJBQXhCO1NBQ1osU0FBUyxDQUFDLFNBQVYsR0FBc0I7QUFGVCIsInNvdXJjZXNDb250ZW50IjpbIiMgc3RhdGljL2NvZmZlZS9wYXltZW50LmNvZmZlZVxuXG4jIEdsb2JhbCB2YXJpYWJsZXNcbnN0cmlwZSAgICAgICAgICAgPSBudWxsXG5lbGVtZW50cyAgICAgICAgID0gbnVsbFxuYmFua0FjY291bnRFbGVtZW50ID0gbnVsbFxucGF5bWVudEludGVudCAgICA9IG51bGxcbmN1cnJlbnRZZWFyICAgICAgPSBudWxsXG5jdXJyZW50TW9udGggICAgID0gbnVsbFxuY3VycmVudEFtb3VudCAgICA9IG51bGxcblxuIyBHZXQgcGF5bWVudCBwZXJpb2QgZnJvbSBVUkwgcXVlcnkgc3RyaW5nXG5nZXRQYXltZW50UGVyaW9kID0gLT5cbiAgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKVxuICB5ZWFyID0gcGFyc2VJbnQocGFyYW1zLmdldCgneWVhcicpKVxuICBtb250aCA9IHBhcnNlSW50KHBhcmFtcy5nZXQoJ21vbnRoJykpXG4gIHsgeWVhciwgbW9udGggfVxuXG4jIEluaXRpYWxpemUgb24gcGFnZSBsb2FkXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyICdET01Db250ZW50TG9hZGVkJywgLT5cbiAgIyBSZXF1aXJlIGF1dGhlbnRpY2F0aW9uXG4gIGF3YWl0IHJlcXVpcmVBdXRoKClcblxuICAjIEdldCBwYXltZW50IHBlcmlvZFxuICB7IHllYXIsIG1vbnRoIH0gPSBnZXRQYXltZW50UGVyaW9kKClcblxuICB1bmxlc3MgeWVhciBhbmQgbW9udGhcbiAgICBzaG93TWVzc2FnZSAnSW52YWxpZCBwYXltZW50IHBlcmlvZCcsICdlcnJvcidcbiAgICByZXR1cm5cblxuICBjdXJyZW50WWVhciA9IHllYXJcbiAgY3VycmVudE1vbnRoID0gbW9udGhcblxuICAjIExvYWQgcmVudCBwZXJpb2QgaW5mb1xuICBhd2FpdCBsb2FkUmVudFBlcmlvZCh5ZWFyLCBtb250aClcblxuICAjIEluaXRpYWxpemUgU3RyaXBlXG4gIGF3YWl0IGluaXRpYWxpemVTdHJpcGUoKVxuXG4jIExvYWQgcmVudCBwZXJpb2QgZGV0YWlsc1xubG9hZFJlbnRQZXJpb2QgPSAoeWVhciwgbW9udGgpIC0+XG4gIHRyeVxuICAgIHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXCIvcmVudC9wZXJpb2QvI3t5ZWFyfS8je21vbnRofVwiKVxuICAgIGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKClcblxuICAgIHVubGVzcyByZXNwb25zZS5va1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGRhdGEuZXJyb3Igb3IgJ0ZhaWxlZCB0byBsb2FkIHJlbnQgcGVyaW9kJylcblxuICAgICMgRGlzcGxheSBwYXltZW50IGluZm9cbiAgICBtb250aE5hbWUgPSBuZXcgRGF0ZSh5ZWFyLCBtb250aCAtIDEpLnRvTG9jYWxlU3RyaW5nKCdkZWZhdWx0JywgeyBtb250aDogJ2xvbmcnIH0pXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BheW1lbnQtcGVyaW9kJykudGV4dENvbnRlbnQgPSBcIiN7bW9udGhOYW1lfSAje3llYXJ9XCJcblxuICAgIGFtb3VudER1ZSA9IGRhdGEuYW1vdW50X2R1ZSAtIChkYXRhLmFtb3VudF9wYWlkIG9yIDApXG4gICAgY3VycmVudEFtb3VudCA9IGFtb3VudER1ZVxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXltZW50LWFtb3VudCcpLnRleHRDb250ZW50ID0gXCIkI3thbW91bnREdWUudG9GaXhlZCgyKX1cIlxuXG4gICAgaWYgYW1vdW50RHVlIDw9IDBcbiAgICAgIHNob3dNZXNzYWdlICdUaGlzIHBlcmlvZCBpcyBhbHJlYWR5IHBhaWQgaW4gZnVsbCcsICdzdWNjZXNzJ1xuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BheS1idXR0b24nKS5kaXNhYmxlZCA9IHRydWVcblxuICBjYXRjaCBlcnJcbiAgICBjb25zb2xlLmVycm9yICdMb2FkIHJlbnQgcGVyaW9kIGVycm9yOicsIGVyclxuICAgIHNob3dNZXNzYWdlIGVyci5tZXNzYWdlLCAnZXJyb3InXG5cbiMgSW5pdGlhbGl6ZSBTdHJpcGVcbmluaXRpYWxpemVTdHJpcGUgPSAtPlxuICB0cnlcbiAgICBjb25zb2xlLmxvZyAnU3RlcCAxOiBGZXRjaGluZyBTdHJpcGUgY29uZmlnLi4uJ1xuICAgICMgR2V0IHB1Ymxpc2hhYmxlIGtleSBmcm9tIGJhY2tlbmRcbiAgICByZXNwb25zZSA9IGF3YWl0IGZldGNoKCcvcGF5bWVudC9jb25maWcnKVxuICAgIGNvbmZpZyA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuICAgIGNvbnNvbGUubG9nICdTdGVwIDI6IEdvdCBjb25maWc6JywgY29uZmlnXG5cbiAgICB1bmxlc3MgY29uZmlnLnB1Ymxpc2hhYmxlS2V5XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1N0cmlwZSBub3QgY29uZmlndXJlZCcpXG5cbiAgICBjb25zb2xlLmxvZyAnU3RlcCAzOiBDaGVja2luZyBTdHJpcGUuanMgbG9hZGVkLi4uJ1xuICAgIHVubGVzcyB3aW5kb3cuU3RyaXBlXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1N0cmlwZS5qcyBub3QgbG9hZGVkIC0gY2hlY2sgc2NyaXB0IHRhZycpXG5cbiAgICBjb25zb2xlLmxvZyAnU3RlcCA0OiBJbml0aWFsaXppbmcgU3RyaXBlLi4uJ1xuICAgICMgSW5pdGlhbGl6ZSBTdHJpcGVcbiAgICBzdHJpcGUgPSBTdHJpcGUoY29uZmlnLnB1Ymxpc2hhYmxlS2V5KVxuXG4gICAgIyBDcmVhdGUgZWxlbWVudHMgd2l0aCBwYXltZW50IGludGVudCBjbGllbnQgc2VjcmV0IG9wdGlvbnNcbiAgICAjIEZvciBub3csIGNyZWF0ZSB3aXRob3V0IGNsaWVudCBzZWNyZXQgLSB3aWxsIGJlIGNyZWF0ZWQgb24gc3VibWl0XG4gICAgZWxlbWVudHMgPSBzdHJpcGUuZWxlbWVudHNcbiAgICAgIG1vZGU6ICdwYXltZW50J1xuICAgICAgYW1vdW50OiBjdXJyZW50QW1vdW50ICogMTAwICAjIFN0cmlwZSB1c2VzIGNlbnRzXG4gICAgICBjdXJyZW5jeTogJ3VzZCdcbiAgICAgIHBheW1lbnRfbWV0aG9kX3R5cGVzOiBbJ3VzX2JhbmtfYWNjb3VudCddXG5cbiAgICBjb25zb2xlLmxvZyAnU3RlcCA1OiBDcmVhdGluZyBwYXltZW50IGVsZW1lbnQuLi4nXG5cbiAgICAjIENyZWF0ZSB1bmlmaWVkIHBheW1lbnQgZWxlbWVudCAoc3VwcG9ydHMgbXVsdGlwbGUgcGF5bWVudCBtZXRob2RzKVxuICAgIGJhbmtBY2NvdW50RWxlbWVudCA9IGVsZW1lbnRzLmNyZWF0ZSAncGF5bWVudCcsXG4gICAgICBsYXlvdXQ6ICd0YWJzJ1xuICAgICAgcGF5bWVudE1ldGhvZE9yZGVyOiBbJ3VzX2JhbmtfYWNjb3VudCddXG5cbiAgICBjb25zb2xlLmxvZyAnU3RlcCA2OiBNb3VudGluZyBlbGVtZW50Li4uJ1xuICAgIGJhbmtBY2NvdW50RWxlbWVudC5tb3VudCgnI2JhbmstYWNjb3VudC1lbGVtZW50JylcbiAgICBjb25zb2xlLmxvZyAnU3RlcCA3OiBTdHJpcGUgaW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5J1xuXG4gICAgIyBFbmFibGUgcGF5IGJ1dHRvbiB3aGVuIGVsZW1lbnQgaXMgcmVhZHlcbiAgICBiYW5rQWNjb3VudEVsZW1lbnQub24gJ3JlYWR5JywgLT5cbiAgICAgIGNvbnNvbGUubG9nICdTdHJpcGUgZWxlbWVudCByZWFkeSdcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXktYnV0dG9uJykuZGlzYWJsZWQgPSBmYWxzZVxuXG4gICAgYmFua0FjY291bnRFbGVtZW50Lm9uICdjaGFuZ2UnLCAoZXZlbnQpIC0+XG4gICAgICBpZiBldmVudC5lcnJvclxuICAgICAgICBzaG93TWVzc2FnZSBldmVudC5lcnJvci5tZXNzYWdlLCAnZXJyb3InXG4gICAgICBlbHNlXG4gICAgICAgIGNsZWFyTWVzc2FnZSgpXG5cbiAgY2F0Y2ggZXJyXG4gICAgY29uc29sZS5lcnJvciAnSW5pdGlhbGl6ZSBTdHJpcGUgZXJyb3I6JywgZXJyXG4gICAgY29uc29sZS5lcnJvciAnRXJyb3Igc3RhY2s6JywgZXJyLnN0YWNrXG4gICAgc2hvd01lc3NhZ2UgXCJGYWlsZWQgdG8gaW5pdGlhbGl6ZSBwYXltZW50IHN5c3RlbTogI3tlcnIubWVzc2FnZX1cIiwgJ2Vycm9yJ1xuXG4jIEhhbmRsZSBwYXltZW50IHN1Ym1pc3Npb25cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgJ2NsaWNrJywgKGUpIC0+XG4gIGlmIGUudGFyZ2V0LmlkIGlzICdwYXktYnV0dG9uJ1xuICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIGF3YWl0IHByb2Nlc3NQYXltZW50KClcblxucHJvY2Vzc1BheW1lbnQgPSAtPlxuICBwYXlCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGF5LWJ1dHRvbicpXG4gIHBheUJ1dHRvbi5kaXNhYmxlZCA9IHRydWVcbiAgcGF5QnV0dG9uLnRleHRDb250ZW50ID0gJ1Byb2Nlc3NpbmcuLi4nXG5cbiAgdHJ5XG4gICAgIyBTdGVwIDE6IFN1Ym1pdCB0aGUgcGF5bWVudCBlbGVtZW50IHRvIHZhbGlkYXRlIGFuZCBjb2xsZWN0IGRhdGFcbiAgICBjb25zb2xlLmxvZyAnU3RlcCAxOiBTdWJtaXR0aW5nIHBheW1lbnQgZWxlbWVudC4uLidcbiAgICBzdWJtaXRSZXN1bHQgPSBhd2FpdCBlbGVtZW50cy5zdWJtaXQoKVxuXG4gICAgaWYgc3VibWl0UmVzdWx0LmVycm9yXG4gICAgICB0aHJvdyBuZXcgRXJyb3Ioc3VibWl0UmVzdWx0LmVycm9yLm1lc3NhZ2UpXG5cbiAgICBjb25zb2xlLmxvZyAnU3RlcCAyOiBDcmVhdGluZyBwYXltZW50IGludGVudC4uLidcbiAgICAjIFN0ZXAgMjogQ3JlYXRlIHBheW1lbnQgaW50ZW50IG9uIHNlcnZlclxuICAgIHJlc3BvbnNlID0gYXdhaXQgZmV0Y2ggJy9wYXltZW50L2NyZWF0ZS1pbnRlbnQnLFxuICAgICAgbWV0aG9kOiAnUE9TVCdcbiAgICAgIGhlYWRlcnM6ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5XG4gICAgICAgIHllYXI6IGN1cnJlbnRZZWFyXG4gICAgICAgIG1vbnRoOiBjdXJyZW50TW9udGhcbiAgICAgICAgYW1vdW50OiBjdXJyZW50QW1vdW50XG5cbiAgICBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpXG5cbiAgICB1bmxlc3MgcmVzcG9uc2Uub2tcbiAgICAgIHRocm93IG5ldyBFcnJvcihkYXRhLmVycm9yIG9yICdGYWlsZWQgdG8gY3JlYXRlIHBheW1lbnQgaW50ZW50JylcblxuICAgIGNsaWVudFNlY3JldCA9IGRhdGEuY2xpZW50U2VjcmV0XG5cbiAgICBjb25zb2xlLmxvZyAnU3RlcCAzOiBDb25maXJtaW5nIHBheW1lbnQuLi4nXG4gICAgIyBTdGVwIDM6IENvbmZpcm0gcGF5bWVudCB1c2luZyB0aGUgdW5pZmllZCBQYXltZW50IEVsZW1lbnRcbiAgICB1c2VyID0gYXdhaXQgZ2V0Q3VycmVudFVzZXIoKVxuXG4gICAgcmVzdWx0ID0gYXdhaXQgc3RyaXBlLmNvbmZpcm1QYXltZW50XG4gICAgICBlbGVtZW50czogZWxlbWVudHNcbiAgICAgIGNsaWVudFNlY3JldDogY2xpZW50U2VjcmV0XG4gICAgICBjb25maXJtUGFyYW1zOlxuICAgICAgICByZXR1cm5fdXJsOiBcIiN7d2luZG93LmxvY2F0aW9uLm9yaWdpbn0vcGF5bWVudC9jb25maXJtP3llYXI9I3tjdXJyZW50WWVhcn0mbW9udGg9I3tjdXJyZW50TW9udGh9XCJcbiAgICAgICAgcGF5bWVudF9tZXRob2RfZGF0YTpcbiAgICAgICAgICBiaWxsaW5nX2RldGFpbHM6XG4gICAgICAgICAgICBuYW1lOiB1c2VyLmVtYWlsXG4gICAgICAgICAgICBlbWFpbDogdXNlci5lbWFpbFxuICAgICAgcmVkaXJlY3Q6ICdpZl9yZXF1aXJlZCdcblxuICAgIGlmIHJlc3VsdC5lcnJvclxuICAgICAgdGhyb3cgbmV3IEVycm9yKHJlc3VsdC5lcnJvci5tZXNzYWdlKVxuXG4gICAgY29uc29sZS5sb2cgJ1N0ZXAgNDogUGF5bWVudCByZXN1bHQ6JywgcmVzdWx0LnBheW1lbnRJbnRlbnQ/LnN0YXR1c1xuICAgICMgUGF5bWVudCBpbml0aWF0ZWQgc3VjY2Vzc2Z1bGx5XG4gICAgaWYgcmVzdWx0LnBheW1lbnRJbnRlbnQ/LnN0YXR1cyBpcyAnc3VjY2VlZGVkJ1xuICAgICAgIyBQYXltZW50IGNvbXBsZXRlZCBpbW1lZGlhdGVseVxuICAgICAgYXdhaXQgY29uZmlybVBheW1lbnQocmVzdWx0LnBheW1lbnRJbnRlbnQuaWQpXG4gICAgZWxzZVxuICAgICAgIyBQYXltZW50IHJlcXVpcmVzIGFkZGl0aW9uYWwgYWN0aW9uXG4gICAgICBzaG93TWVzc2FnZSAnUGF5bWVudCBpbml0aWF0ZWQhIFlvdSBtYXkgbmVlZCB0byB2ZXJpZnkgd2l0aCB5b3VyIGJhbmsuJywgJ3N1Y2Nlc3MnXG4gICAgICBhd2FpdCBjaGVja1BheW1lbnRTdGF0dXMocmVzdWx0LnBheW1lbnRJbnRlbnQuaWQpXG5cbiAgY2F0Y2ggZXJyXG4gICAgY29uc29sZS5lcnJvciAnUHJvY2VzcyBwYXltZW50IGVycm9yOicsIGVyclxuICAgIHNob3dNZXNzYWdlIGVyci5tZXNzYWdlLCAnZXJyb3InXG4gICAgcGF5QnV0dG9uLmRpc2FibGVkID0gZmFsc2VcbiAgICBwYXlCdXR0b24udGV4dENvbnRlbnQgPSAnUHJvY2VzcyBQYXltZW50J1xuXG4jIENoZWNrIHBheW1lbnQgc3RhdHVzIGFuZCBjb25maXJtXG5jaGVja1BheW1lbnRTdGF0dXMgPSAocGF5bWVudEludGVudElkKSAtPlxuICB0cnlcbiAgICAjIFBvbGwgZm9yIHBheW1lbnQgc3RhdHVzXG4gICAgbWF4QXR0ZW1wdHMgPSAzMFxuICAgIGF0dGVtcHQgPSAwXG5cbiAgICBjaGVja1N0YXR1cyA9IC0+XG4gICAgICBhdHRlbXB0KytcblxuICAgICAgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcIi9wYXltZW50L3N0YXR1cy8je3BheW1lbnRJbnRlbnRJZH1cIilcbiAgICAgIHN0YXR1cyA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuXG4gICAgICBpZiBzdGF0dXMuc3RhdHVzIGlzICdzdWNjZWVkZWQnXG4gICAgICAgICMgQ29uZmlybSBwYXltZW50IGluIGJhY2tlbmRcbiAgICAgICAgYXdhaXQgY29uZmlybVBheW1lbnQocGF5bWVudEludGVudElkKVxuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgZWxzZSBpZiBzdGF0dXMuc3RhdHVzIGlzICdyZXF1aXJlc19hY3Rpb24nIG9yIHN0YXR1cy5zdGF0dXMgaXMgJ3Byb2Nlc3NpbmcnXG4gICAgICAgIGlmIGF0dGVtcHQgPCBtYXhBdHRlbXB0c1xuICAgICAgICAgIHNldFRpbWVvdXQgY2hlY2tTdGF0dXMsIDIwMDAgICMgQ2hlY2sgYWdhaW4gaW4gMiBzZWNvbmRzXG4gICAgICAgIGVsc2VcbiAgICAgICAgICBzaG93TWVzc2FnZSAnUGF5bWVudCBpcyBwcm9jZXNzaW5nLiBDaGVjayBiYWNrIGxhdGVyLicsICdzdWNjZXNzJ1xuICAgICAgICAgIHNldFRpbWVvdXQgKC0+IHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy9yZW50JyksIDMwMDBcbiAgICAgIGVsc2UgaWYgc3RhdHVzLnN0YXR1cyBpcyAncmVxdWlyZXNfcGF5bWVudF9tZXRob2QnXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignUGF5bWVudCBtZXRob2QgdmVyaWZpY2F0aW9uIHJlcXVpcmVkJylcbiAgICAgIGVsc2VcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUGF5bWVudCBmYWlsZWQ6ICN7c3RhdHVzLnN0YXR1c31cIilcblxuICAgIGF3YWl0IGNoZWNrU3RhdHVzKClcblxuICBjYXRjaCBlcnJcbiAgICBjb25zb2xlLmVycm9yICdDaGVjayBwYXltZW50IHN0YXR1cyBlcnJvcjonLCBlcnJcbiAgICBzaG93TWVzc2FnZSBlcnIubWVzc2FnZSwgJ2Vycm9yJ1xuXG4jIENvbmZpcm0gcGF5bWVudCBpbiBiYWNrZW5kXG5jb25maXJtUGF5bWVudCA9IChwYXltZW50SW50ZW50SWQpIC0+XG4gIHRyeVxuICAgIHJlc3BvbnNlID0gYXdhaXQgZmV0Y2ggJy9wYXltZW50L2NvbmZpcm0nLFxuICAgICAgbWV0aG9kOiAnUE9TVCdcbiAgICAgIGhlYWRlcnM6ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5XG4gICAgICAgIHBheW1lbnRJbnRlbnRJZDogcGF5bWVudEludGVudElkXG4gICAgICAgIHllYXI6IGN1cnJlbnRZZWFyXG4gICAgICAgIG1vbnRoOiBjdXJyZW50TW9udGhcblxuICAgIGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKClcblxuICAgIHVubGVzcyByZXNwb25zZS5va1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGRhdGEuZXJyb3Igb3IgJ0ZhaWxlZCB0byBjb25maXJtIHBheW1lbnQnKVxuXG4gICAgc2hvd01lc3NhZ2UgJ1BheW1lbnQgc3VjY2Vzc2Z1bCEgUmVkaXJlY3RpbmcuLi4nLCAnc3VjY2VzcydcbiAgICBzZXRUaW1lb3V0ICgtPiB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvcmVudCcpLCAyMDAwXG5cbiAgY2F0Y2ggZXJyXG4gICAgY29uc29sZS5lcnJvciAnQ29uZmlybSBwYXltZW50IGVycm9yOicsIGVyclxuICAgIHNob3dNZXNzYWdlIGVyci5tZXNzYWdlLCAnZXJyb3InXG5cbiMgU2hvdyBtZXNzYWdlIHRvIHVzZXJcbnNob3dNZXNzYWdlID0gKHRleHQsIHR5cGUpIC0+XG4gIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXNzYWdlLWNvbnRhaW5lcicpXG4gIGNvbnRhaW5lci5pbm5lckhUTUwgPSBcIlwiXCJcbiAgICA8ZGl2IGNsYXNzPVwibWVzc2FnZSAje3R5cGV9XCI+I3t0ZXh0fTwvZGl2PlxuICBcIlwiXCJcblxuY2xlYXJNZXNzYWdlID0gLT5cbiAgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21lc3NhZ2UtY29udGFpbmVyJylcbiAgY29udGFpbmVyLmlubmVySFRNTCA9ICcnXG4iXX0=
//# sourceURL=/mnt/nvme0n1p4/git/github/rdeforest/RentCoordinator/static/coffee/payment.coffee